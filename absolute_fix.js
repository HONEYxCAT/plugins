!function(){"use strict";var e={id:"anime_smart_tizen",version:"11.0",gap:90,dateToDays:function(e){if(!e||"string"!=typeof e)return 0;var s=e.split("-");return 3!==s.length?0:365*parseInt(s[0],10)+30*parseInt(s[1],10)+parseInt(s[2],10)},init:function(){console.log("AnimeFix: Start v"+this.version),this.hook()},hook:function(){var e=this;if(!window.$||!window.$.ajax)return setTimeout((function(){e.hook()}),200);var s=window.$.ajax;window.$.ajax=function(n,r){var t=("object"==typeof n?n:r)||{},o=("string"==typeof n?n:t.url)||"",a=o.match(/\/tv\/(\d+)\/season\/(\d+)/);if(a){var i=a[1],u=parseInt(a[2],10),p=t.success,c=t.error,d=t.complete,l=$.Deferred(),f=l.promise();f.abort=function(){};var v=function(){var n=o.replace(/\/season\/\d+/,"/season/1");s({url:n,type:"GET",dataType:"json",success:function(s){try{var n=e.process(s,u,i),r={responseText:JSON.stringify(n),responseJSON:n,status:200,statusText:"OK",readyState:4};p&&p(n,"success",r),d&&d(r,"success"),l.resolve(n,"success",r)}catch(e){console.log("AnimeFix: Process Error",e),p&&p(s,"success",{status:200}),l.resolve(s,"success",{status:200})}},error:function(s,n,r){if(u>1){var t=e.makeStubs(i,u);p&&p(t,"success",{status:200}),l.resolve(t,"success",{status:200})}else c&&c(s,n,r),l.reject(s,n,r)}})};return s({url:o,type:"GET",dataType:"json",success:function(s,n,r){if(s&&s.episodes&&s.episodes.length>0){if(1===u){try{var t=e.process(s,1,i);p&&p(t,n,r),d&&d(r,n),l.resolve(t,n,r)}catch(e){p&&p(s,n,r),d&&d(r,n),l.resolve(s,n,r)}return}p&&p(s,n,r),d&&d(r,n),l.resolve(s,n,r)}else v()},error:function(e,s,n){v()}}),f}return s.apply(this,arguments)}},process:function(e,s,n){var r=JSON.parse(JSON.stringify(e)),t=r.episodes||[];if(0===t.length)return r;var o={},a=1,i=0;t.sort((function(e,s){return e.episode_number-s.episode_number}));for(var u=0;u<t.length;u++){var p=t[u],c=this.dateToDays(p.air_date);c>0&&i>0&&c-i>this.gap&&(a++,console.log("AnimeFix: Split found at EP "+p.episode_number)),c>0&&(i=c),o[a]||(o[a]=[]),p.season_number=a,p.episode_number=o[a].length+1,p.id=9e5+1e3*a+p.episode_number,o[a].push(p)}var d=o[s]||[];if(s>1&&0===d.length){console.log("AnimeFix: Season empty, creating stubs");for(var l=1;l<=12;l++)d.push({id:888e3+l,episode_number:l,name:"Episode "+l,air_date:"2025-01-01",overview:"Нет данных в TMDB. (SmartFix)",season_number:s,still_path:null,vote_average:5})}return r.episodes=d,r.name="Season "+s,r.season_number=s,r._id="smart_id_"+n+"_"+s,r.id=5e4+100*s,r},makeStubs:function(e,s){for(var n=[],r=1;r<=12;r++)n.push({id:777e3+r,episode_number:r,name:"Episode "+r,overview:"Offline Fix",season_number:s,air_date:"2025-01-01",still_path:null});return{episodes:n,name:"Season "+s,season_number:s,overview:"",id:666e3,poster_path:null}}};function s(){window.ANIME_FIX_LOADED||(window.ANIME_FIX_LOADED=!0,e.init())}if("undefined"!=typeof Lampa)window.appready?s():Lampa.Listener.follow("app",(function(e){"ready"==e.type&&s()}));else var n=setInterval((function(){"undefined"!=typeof Lampa&&(clearInterval(n),window.appready?s():Lampa.Listener.follow("app",(function(e){"ready"==e.type&&s()})))}),100)}();
