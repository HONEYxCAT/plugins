!function(){"use strict";var e,s={gap:90,init:function(){this.hook()},dToN:function(e){if(!e||"string"!=typeof e)return 0;var s=e.split("-");return 3!==s.length?0:365*parseInt(s[0],10)+30*parseInt(s[1],10)+parseInt(s[2],10)},hook:function(){var e=this;if(!window.$||!window.$.ajax)return setTimeout((function(){e.hook()}),500);var s=window.$.ajax;window.$.ajax=function(r,n){var t=("object"==typeof r?r:n)||{},o=("string"==typeof r?r:t.url)||"",a=o.match(/\/tv\/(\d+)\/season\/(\d+)/);if(a){var i=a[1],u=parseInt(a[2],10),c="undefined"!=typeof Lampa&&Lampa.Storage?Lampa.Storage.get("language","ru"):"ru",p="http://api.themoviedb.org/3/tv/"+i+"/season/1?api_key=4ef0d7355d9ffb5151e987764708ce96&language="+c,f=$.Deferred();s({url:p,dataType:"json",success:function(r){var n=e.proc(r,u,i);if(n.episodes.length>0){var a={responseText:JSON.stringify(n),responseJSON:n,status:200,statusText:"OK"};t.success&&t.success(n,"success",a),t.complete&&t.complete(a,"success"),f.resolve(n)}else s({url:o,success:t.success,complete:t.complete,error:function(s,r,n){if(u>1){var o=e.stub(i,u);t.success&&t.success(o,"success",{status:200}),f.resolve(o)}else t.error&&t.error(s,r,n),f.reject(s,r,n)}})},error:function(){s({url:o,success:t.success,error:function(s,r,n){if(u>1){var o=e.stub(i,u);t.success&&t.success(o,"success",{status:200}),f.resolve(o)}else t.error&&t.error(s,r,n),f.reject(s,r,n)}})}});var d=f.promise();return d.abort=function(){},d}return s.apply(this,arguments)}},proc:function(e,s,r){var n=JSON.parse(JSON.stringify(e)),t=n.episodes||[],o={},a=1,i=0;if(0===t.length)return n;t.sort((function(e,s){return e.episode_number-s.episode_number}));for(var u=0;u<t.length;u++){var c=t[u],p=this.dToN(c.air_date);p>0&&i>0&&p-i>this.gap&&a++,p>0&&(i=p),o[a]||(o[a]=[]),c.season_number=a,c.episode_number=o[a].length+1,c.id=9e5+1e4*a+c.episode_number,o[a].push(c)}var f=o[s]||[];return n.episodes=f,n.name="Season "+s,n.season_number=s,n._id="smart_"+r+"_"+s,n.id=7e4+500*s,n},stub:function(e,s){for(var r=[],n=1;n<=13;n++)r.push({id:88e4+100*s+n,episode_number:n,name:"Episode "+n,overview:"...",season_number:s,air_date:"2025-01-01",still_path:null,vote_average:0});return{episodes:r,name:"Season "+s,season_number:s,overview:"",id:66e4+s,poster_path:null}}};function r(){window.anime_fix_init||(window.anime_fix_init=!0,s.init())}"undefined"!=typeof Lampa&&Lampa.Listener?window.appready?r():Lampa.Listener.follow("app",(function(e){"ready"==e.type&&r()})):e=setInterval((function(){"undefined"!=typeof Lampa&&(clearInterval(e),r())}),200)}();
